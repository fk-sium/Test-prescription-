<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProRx - E-Prescription System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. VARIABLES & RESET --- */
        :root {
            --primary: #0e7490; /* Cyan 700 */
            --primary-light: #ecfeff;
            --bg-gray: #f3f4f6;
            --border: #d1d5db;
            --text: #1f2937;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg-gray); color: var(--text); height: 100vh; overflow: hidden; }

        /* --- 2. LAYOUT --- */
        .app-container { display: flex; height: 100vh; }
        
        /* Sidebar (Editor) */
        .editor { width: 420px; background: white; border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; box-shadow: var(--shadow); }
        .editor-header { padding: 15px 20px; border-bottom: 1px solid var(--border); background: var(--primary); color: white; }
        .editor-header h2 { margin: 0; font-size: 18px; font-weight: 600; }
        .editor-body { flex: 1; overflow-y: auto; padding: 20px; }
        .editor-footer { padding: 15px 20px; border-top: 1px solid var(--border); background: #f9fafb; display: flex; gap: 10px; }

        /* Preview Area */
        .preview { flex: 1; background: #52525b; padding: 40px; overflow-y: auto; display: flex; justify-content: center; }
        .paper { 
            width: 210mm; min-height: 297mm; background: white; 
            padding: 15mm; box-shadow: 0 10px 25px rgba(0,0,0,0.2); 
            display: flex; flex-direction: column;
            position: relative;
        }

        /* --- 3. FORM ELEMENTS --- */
        .form-group { margin-bottom: 15px; position: relative; }
        label { display: block; font-size: 12px; font-weight: 600; margin-bottom: 5px; color: #4b5563; text-transform: uppercase; }
        input, textarea, select { 
            width: 100%; padding: 10px; border: 1px solid var(--border); 
            border-radius: 6px; font-size: 14px; font-family: inherit; transition: 0.2s;
        }
        input:focus, textarea:focus { border-color: var(--primary); ring: 2px solid var(--primary-light); }
        .row { display: flex; gap: 10px; }
        .col { flex: 1; }

        /* Buttons */
        .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 14px; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; flex: 1; }
        .btn-primary:hover { background: #0891b2; }
        .btn-secondary { background: white; border: 1px solid var(--border); color: var(--text); }
        .btn-add { width: 100%; background: #f0fdfa; color: var(--primary); border: 1px dashed var(--primary); margin-top: 10px; }
        .btn-add:hover { background: #ccfbf1; }
        .btn-remove { color: red; background: transparent; border: none; cursor: pointer; font-size: 18px; padding: 0 5px; }

        /* --- 4. AUTOCOMPLETE STYLES --- */
        .autocomplete-items {
            position: absolute; border: 1px solid #d4d4d4; border-bottom: none; border-top: none; z-index: 99;
            top: 100%; left: 0; right: 0; border-radius: 0 0 6px 6px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .autocomplete-items div { padding: 10px; cursor: pointer; background-color: #fff; border-bottom: 1px solid #d4d4d4; font-size: 13px; }
        .autocomplete-items div:hover { background-color: #e9e9e9; }
        .autocomplete-active { background-color: var(--primary) !important; color: #ffffff; }

        /* --- 5. PRESCRIPTION DESIGN (A4) --- */
        .rx-header { text-align: center; border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 20px; }
        .dr-name { font-size: 22px; font-weight: 700; color: var(--primary); text-transform: uppercase; }
        .dr-meta { font-size: 12px; color: #666; margin-top: 5px; line-height: 1.4; }
        
        .pt-bar { display: flex; justify-content: space-between; background: #f3f4f6; padding: 8px 12px; border-radius: 4px; font-size: 13px; margin-bottom: 20px; border: 1px solid #e5e7eb; }
        
        .main-content { display: flex; gap: 20px; flex: 1; }
        .left-panel { width: 30%; border-right: 1px solid #e5e7eb; padding-right: 15px; }
        .right-panel { flex: 1; padding-left: 10px; }
        
        .section-title { font-size: 12px; font-weight: 700; text-transform: uppercase; color: #9ca3af; border-bottom: 1px solid #e5e7eb; margin: 15px 0 8px 0; padding-bottom: 2px; }
        .data-content { font-size: 13px; white-space: pre-wrap; line-height: 1.5; }
        
        .rx-symbol { font-family: serif; font-style: italic; font-size: 30px; font-weight: bold; margin-bottom: 10px; }
        
        table.med-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        table.med-table th { text-align: left; border-bottom: 1px solid #e5e7eb; padding: 5px 0; color: #6b7280; font-size: 11px; text-transform: uppercase; }
        table.med-table td { padding: 8px 0; border-bottom: 1px solid #f3f4f6; vertical-align: top; }
        .med-name { font-weight: 600; font-size: 14px; color: #111; }
        .med-inst { font-size: 11px; color: #666; }

        .rx-footer { margin-top: auto; display: flex; justify-content: space-between; padding-top: 40px; align-items: flex-end; }
        .signature { border-top: 1px solid #9ca3af; width: 180px; text-align: center; padding-top: 5px; font-size: 12px; }

        /* --- 6. PRINT HANDLING --- */
        @media print {
            .editor, .editor-footer, .noprint { display: none !important; }
            .app-container, .preview { display: block; height: auto; background: white; padding: 0; }
            .paper { box-shadow: none; width: 100%; padding: 20px 40px; min-height: auto; }
            body { background: white; overflow: visible; }
            @page { size: A4; margin: 0; }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <div class="editor">
        <div class="editor-header">
            <h2>üìù E-Prescription</h2>
        </div>
        <div class="editor-body">
            
            <div class="form-group">
                <label>Doctor Name & Credentials</label>
                <input type="text" id="in_drName" value="Dr. Md Rezaul Karim (Shrabon)" placeholder="Doctor Name">
                <textarea id="in_drMeta" rows="3" style="margin-top:5px" placeholder="Degrees, Reg No...">MBBS (CMCH), MRCS Part-A (London)
Ex-RMO - Labaid Cancer Hospital
BMDC Reg: A-119828</textarea>
            </div>

            <hr style="border:0; border-top:1px solid #e5e7eb; margin: 15px 0;">

            <div class="row">
                <div class="col"><label>Patient Name</label><input type="text" id="in_pName" placeholder="Full Name"></div>
                <div class="col" style="flex: 0 0 70px"><label>Age</label><input type="text" id="in_pAge" placeholder="30"></div>
            </div>
            <div class="row" style="margin-top:10px">
                <div class="col"><label>Gender</label>
                    <select id="in_pSex"><option>Male</option><option>Female</option><option>Child</option></select>
                </div>
                <div class="col"><label>Date</label><input type="date" id="in_date"></div>
            </div>

            <div class="form-group" style="margin-top:15px">
                <label>Chief Complaints (Start typing...)</label>
                <div class="autocomplete">
                    <textarea id="in_cc" rows="2" placeholder="e.g. Fever, Headache..."></textarea>
                </div>
            </div>

            <div class="form-group">
                <label>Diagnosis</label>
                <div class="autocomplete">
                    <input type="text" id="in_dx" placeholder="e.g. Viral Fever">
                </div>
            </div>

            <div class="form-group">
                <label>Medicines (Rx)</label>
                <div id="med-inputs-container"></div>
                <button type="button" class="btn btn-add" onclick="addMedRow()">+ Add Medicine</button>
            </div>

            <div class="form-group">
                <label>Tests / Investigations</label>
                <div class="autocomplete">
                    <textarea id="in_tests" rows="2" placeholder="e.g. CBC, X-Ray"></textarea>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <label>Advice</label>
                    <div class="autocomplete">
                        <textarea id="in_advice" rows="2" placeholder="e.g. Take rest"></textarea>
                    </div>
                </div>
                <div class="col">
                    <label>Follow Up</label>
                    <input type="date" id="in_follow">
                </div>
            </div>

        </div>
        
        <div class="editor-footer">
            <button class="btn btn-secondary" onclick="resetForm()">Reset</button>
            <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print Prescription</button>
        </div>
    </div>

    <div class="preview">
        <div class="paper" id="print-area">
            
            <div class="rx-header">
                <div class="dr-name" id="out_drName"></div>
                <div class="dr-meta" id="out_drMeta"></div>
            </div>

            <div class="pt-bar">
                <div><strong>Name:</strong> <span id="out_pName"></span></div>
                <div><strong>Age/Sex:</strong> <span id="out_pAgeSex"></span></div>
                <div><strong>Date:</strong> <span id="out_date"></span></div>
            </div>

            <div class="main-content">
                
                <div class="left-panel">
                    <div id="wrap_cc">
                        <div class="section-title">Chief Complaints</div>
                        <div class="data-content" id="out_cc"></div>
                    </div>
                    
                    <div id="wrap_tests" style="margin-top:20px">
                        <div class="section-title">Inv. / Tests</div>
                        <div class="data-content" id="out_tests"></div>
                    </div>

                    <div id="wrap_dx" style="margin-top:20px">
                        <div class="section-title">Diagnosis</div>
                        <div class="data-content" id="out_dx"></div>
                    </div>
                </div>

                <div class="right-panel">
                    <div class="rx-symbol">Rx</div>
                    
                    <table class="med-table">
                        <thead>
                            <tr>
                                <th width="5%">#</th>
                                <th width="55%">Medicine Name</th>
                                <th width="25%">Dosage</th>
                                <th width="15%">Dur.</th>
                            </tr>
                        </thead>
                        <tbody id="out_med_tbody"></tbody>
                    </table>

                    <div id="wrap_advice" style="margin-top:30px">
                        <div class="section-title">Advice</div>
                        <div class="data-content" id="out_advice"></div>
                    </div>

                    <div id="wrap_follow" style="margin-top:15px; font-weight:600; font-size:13px">
                        Next Visit: <span id="out_follow"></span>
                    </div>
                </div>
            </div>

            <div class="rx-footer">
                <div style="font-size:10px; color:#999">Generated by ProRx System</div>
                <div class="signature">Signature</div>
            </div>
        </div>
    </div>

</div>

<script>
    // --- 1. DATABASE (AUTOCOMPLETE DATA) ---
    const DB = {
        complaints: ["Fever", "Headache", "Cough", "Abdominal Pain", "Vomiting", "Loose Motion", "Chest Pain", "Weakness", "Back Pain", "Skin Rash", "Sore Throat"],
        medicines: [
            "Tab. Napa Extend (Paracetamol)", "Tab. Napa 500mg", "Tab. Pantonix 20mg", "Cap. Omep 20mg", 
            "Tab. Sergel 20mg", "Tab. Monas 10", "Tab. Fexo 120mg", "Syr. Tofen", "Syr. Napa", 
            "Tab. Azithromycin 500mg", "Tab. Ciprofloxacin 500mg", "Tab. Metro 400mg", "Cap. Maxpro 20",
            "Tab. Calbo-D", "Tab. Bizoran 5/20", "Tab. Comet 500"
        ],
        dosages: ["1+1+1", "1+0+1", "1+0+0", "0+0+1", "0+1+0", "1+1+1+1", "S.O.S"],
        instructions: ["After meal", "Before meal", "Empty stomach", "With water", "If pain persists", "Continue"],
        tests: ["CBC", "Urine R/E", "RBS", "Serum Creatinine", "Lipid Profile", "ECG", "Chest X-Ray", "Ultrasonogram", "HBsAg"],
        advice: ["Drink plenty of water", "Take rest", "Avoid oily food", "Do not smoke", "Regular exercise"]
    };

    // --- 2. INITIALIZATION ---
    const today = new Date().toISOString().slice(0, 10);
    document.getElementById('in_date').value = today;
    let medRows = [];

    // --- 3. AUTOCOMPLETE ENGINE ---
    function autocomplete(inp, arr) {
        let currentFocus;
        inp.addEventListener("input", function(e) {
            let val = this.value;
            // Only suggest for the last word if it's a textarea
            const isTextArea = this.tagName === 'TEXTAREA';
            let searchVal = val;
            
            /* Close any already open lists */
            closeAllLists();
            if (!val) { return false;}
            currentFocus = -1;
            
            /* Create container */
            let a = document.createElement("DIV");
            a.setAttribute("id", this.id + "autocomplete-list");
            a.setAttribute("class", "autocomplete-items");
            this.parentNode.appendChild(a);
            
            /* Filter and create items */
            for (let i = 0; i < arr.length; i++) {
                if (arr[i].toLowerCase().includes(searchVal.toLowerCase())) {
                    let b = document.createElement("DIV");
                    b.innerHTML = arr[i].replace(new RegExp(searchVal, "gi"), (match) => `<strong>${match}</strong>`);
                    b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                    b.addEventListener("click", function(e) {
                        inp.value = this.getElementsByTagName("input")[0].value;
                        closeAllLists();
                        updatePreview();
                    });
                    a.appendChild(b);
                }
            }
        });

        /* Keyboard navigation */
        inp.addEventListener("keydown", function(e) {
            let x = document.getElementById(this.id + "autocomplete-list");
            if (x) x = x.getElementsByTagName("div");
            if (e.keyCode == 40) { // Down
                currentFocus++;
                addActive(x);
            } else if (e.keyCode == 38) { // Up
                currentFocus--;
                addActive(x);
            } else if (e.keyCode == 13) { // Enter
                e.preventDefault();
                if (currentFocus > -1) { if (x) x[currentFocus].click(); }
            }
        });

        function addActive(x) {
            if (!x) return false;
            removeActive(x);
            if (currentFocus >= x.length) currentFocus = 0;
            if (currentFocus < 0) currentFocus = (x.length - 1);
            x[currentFocus].classList.add("autocomplete-active");
        }
        function removeActive(x) {
            for (let i = 0; i < x.length; i++) { x[i].classList.remove("autocomplete-active"); }
        }
        function closeAllLists(elmnt) {
            var x = document.getElementsByClassName("autocomplete-items");
            for (var i = 0; i < x.length; i++) {
                if (elmnt != x[i] && elmnt != inp) { x[i].parentNode.removeChild(x[i]); }
            }
        }
        document.addEventListener("click", function (e) { closeAllLists(e.target); });
    }

    // --- 4. MEDICINE ROW LOGIC ---
    function addMedRow() {
        const id = Date.now();
        const container = document.getElementById('med-inputs-container');
        const div = document.createElement('div');
        div.className = 'med-card form-group';
        div.style.background = '#fff'; div.style.padding='10px'; div.style.border='1px solid #e5e7eb'; div.style.marginBottom='10px';
        
        div.innerHTML = `
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <label>Medicine Name</label>
                <button class="btn-remove" onclick="removeMed(this)">√ó</button>
            </div>
            <div style="position:relative">
                <input type="text" class="med-name-in" placeholder="Type medicine..." oninput="updatePreview()">
            </div>
            <div class="row" style="margin-top:8px">
                <div class="col" style="position:relative">
                    <input type="text" class="med-dose-in" placeholder="1+0+1" oninput="updatePreview()">
                </div>
                <div class="col">
                    <input type="text" class="med-dur-in" placeholder="5 days" oninput="updatePreview()">
                </div>
            </div>
            <div style="margin-top:8px; position:relative">
                <input type="text" class="med-inst-in" placeholder="Instruction (e.g. After meal)" oninput="updatePreview()">
            </div>
        `;
        container.appendChild(div);
        
        // Apply autocomplete to new inputs
        autocomplete(div.querySelector('.med-name-in'), DB.medicines);
        autocomplete(div.querySelector('.med-dose-in'), DB.dosages);
        autocomplete(div.querySelector('.med-inst-in'), DB.instructions);
    }

    function removeMed(btn) {
        btn.closest('.med-card').remove();
        updatePreview();
    }

    // --- 5. LIVE PREVIEW LOGIC ---
    function updatePreview() {
        // Simple text fields
        document.getElementById('out_drName').textContent = document.getElementById('in_drName').value;
        document.getElementById('out_drMeta').innerText = document.getElementById('in_drMeta').value;
        
        const pName = document.getElementById('in_pName').value || "..........................";
        const pAge = document.getElementById('in_pAge').value;
        const pSex = document.getElementById('in_pSex').value;
        
        document.getElementById('out_pName').textContent = pName;
        document.getElementById('out_pAgeSex').textContent = (pAge ? pAge + "Y" : "") + " / " + pSex;
        document.getElementById('out_date').textContent = document.getElementById('in_date').value;

        // Text Areas
        document.getElementById('out_cc').innerText = document.getElementById('in_cc').value;
        document.getElementById('out_tests').innerText = document.getElementById('in_tests').value;
        document.getElementById('out_dx').innerText = document.getElementById('in_dx').value;
        document.getElementById('out_advice').innerText = document.getElementById('in_advice').value;

        const follow = document.getElementById('in_follow').value;
        document.getElementById('wrap_follow').style.display = follow ? 'block' : 'none';
        document.getElementById('out_follow').innerText = follow;

        // Medicines Table
        const tbody = document.getElementById('out_med_tbody');
        tbody.innerHTML = '';
        const medCards = document.querySelectorAll('.med-card');
        
        medCards.forEach((card, index) => {
            const name = card.querySelector('.med-name-in').value;
            const dose = card.querySelector('.med-dose-in').value;
            const dur = card.querySelector('.med-dur-in').value;
            const inst = card.querySelector('.med-inst-in').value;

            if (name || dose) {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}.</td>
                    <td>
                        <div class="med-name">${name}</div>
                        <div class="med-inst">${inst}</div>
                    </td>
                    <td style="font-weight:600">${dose}</td>
                    <td>${dur}</td>
                `;
                tbody.appendChild(tr);
            }
        });
    }

    function resetForm() {
        if(confirm('Clear all data?')) {
            document.querySelectorAll('input, textarea').forEach(i => {
                if(i.type !== 'date' && i.id !== 'in_drName' && i.id !== 'in_drMeta') i.value = '';
            });
            document.getElementById('med-inputs-container').innerHTML = '';
            addMedRow();
            updatePreview();
        }
    }

    // --- 6. BINDINGS & INIT ---
    // Bind all standard inputs to updatePreview
    const inputs = ['in_drName', 'in_drMeta', 'in_pName', 'in_pAge', 'in_pSex', 'in_date', 'in_cc', 'in_tests', 'in_dx', 'in_advice', 'in_follow'];
    inputs.forEach(id => {
        document.getElementById(id).addEventListener('input', updatePreview);
    });

    // Apply autocomplete to static fields
    autocomplete(document.getElementById('in_cc'), DB.complaints);
    autocomplete(document.getElementById('in_dx'), DB.complaints); // Using complaints as diagnosis base
    autocomplete(document.getElementById('in_tests'), DB.tests);
    autocomplete(document.getElementById('in_advice'), DB.advice);

    // Start with one medicine row
    addMedRow();
    updatePreview();

</script>
</body>
</html>
